<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" text="text/css" href="style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Car Mileage Calculator</title>
</head>

<body>
    <div class="container">
        <div class="row">
            <a href="../index.html" class="home display-7 text-center mb-3"><svg width="24" height="24" viewBox="0 0 24 24">
                    <path d="M21 13v10h-6v-6h-6v6h-6v-10h-3l12-12 12 12h-3zm-1-5.907v-5.093h-3v2.093l3 3z" /></svg></a>
            <div class="col-md-6 offset-md-3">
                <h1 class="display-5 text-center mb-3">Car Mileage Calculator</h1>
                <form id="form-group">
                    <input id="yearInput" type="number" min="1900" class="form-control form-control-lg" placeholder="Enter Year...">
                    <input id="monthInput" type="number" min="1" max="12" class="form-control form-control-lg" placeholder="Enter Month...">
                    <input id="mileageInput" type="number" min="0" class="form-control form-control-lg" placeholder="Enter Mileage...">
                    <button onClick="window.location.reload(true)">Reset</button>
                </form>
                <br>

                <div class="card">
                    <div class="card-body" id="resultColored">
                        <div id="resultOutput"></div>
                    </div>
                </div>

                <br>
                <p>Pending:</p>
                <ul>
                    <li>Remove mileage display</li>
                    <li>Move script to external file</li>
                    <li>Change bootstrap layout to css grid</li>
                    <li>Commas in input need to be looked at</li>
                    <li>Better input tests</li>
                    <li>Make result box change color based on output:</li>
                    <ul>
                        <li>Success is green</li>
                        <li>Error is red</li>
                        <li>Warning is yellow</li>
                    </ul>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const getCurrentYear = new Date().getFullYear();
        const getCurrentMonth = new Date().getMonth() + 1;

        const yearInput = document.getElementById("yearInput");
        const monthInput = document.getElementById("monthInput");
        const mileageInput = document.getElementById("mileageInput");
        const resultOutput = document.getElementById("resultOutput");

        function inputHandler() {
            const yearCalc = getCurrentYear - yearInput.value;
            const avgMileagePerMonth = 1666;
            const avgMileagePerYear = 19992;
            const maxMileage1 = getCurrentMonth * avgMileagePerMonth;
            const maxMileage2 = ((yearCalc - 1) * avgMileagePerYear) + ((12 - monthInput.value) * 1666) + (getCurrentMonth * 1666);
            const mileageAverage = yearCalc * 19992;

            const yearLengthRule = yearInput.value.toString().length;
            const monthLengthRule = monthInput.value.toString().length;
            const mileageLengthRule = mileageInput.value.toString().length;

            let documentElement = document.getElementById("resultOutput");

            if (yearInput.value === "" || monthInput.value === "" || mileageInput.value === "") {
                documentElement.innerHTML = `Please fill in all fields`;
            } else if (getCurrentYear == yearInput.value) {
                if (monthInput.value <= getCurrentMonth) {
                    if (maxMileage1 > mileageInput.value) {
                        documentElement.innerHTML =
                            // ${mileageDisplay(maxMileage1, mileageInput.value)} <br>
                            `${maxMileageGTMileage(maxMileage1, mileageInput.value)}`;
                    } else if (maxMileage1 < mileageInput.value) {
                        documentElement.innerHTML =
                            `${maxMileageLTMileage(maxMileage1, mileageInput.value)}`;
                    } else {
                        // document.getElementById("resultOutput").innerHTML = `${mileageEquals()}`;
                        documentElement.innerHTML = `${mileageEquals()}`;
                    }
                } else {
                    documentElement.innerHTML = `${monthWarning()}`;
                }
            } else if (yearInput.value < getCurrentYear) {
                if (getCurrentMonth != monthInput.value) {
                    if (maxMileage2 > mileageInput.value) {
                        document.getElementById("resultOutput").innerHTML =
                            // ${mileageDisplay(maxMileage2, mileageInput.value)} <br>
                            `${maxMileageGTMileage(maxMileage2, mileageInput.value)}`;
                    } else if (maxMileage2 < mileageInput.value) {
                        document.getElementById("resultOutput").innerHTML = `
                        ${maxMileageLTMileage(maxMileage2, mileageInput.value)}`;
                    } else {
                        document.getElementById("resultOutput").innerHTML = `${mileageEquals()}`;
                    }
                } else if (getCurrentMonth == monthInput.value) {
                    if (mileageAverage > mileageInput.value) {
                        document.getElementById("resultOutput").innerHTML =
                            // ${mileageDisplay(mileageAverage, mileageInput.value)} <br>
                            `${maxMileageGTMileage(mileageAverage, mileageInput.value)}`;
                    } else if (mileageAverage < mileageInput.value) {
                        document.getElementById("resultOutput").innerHTML = `
                        ${maxMileageLTMileage(mileageAverage, mileageInput.value)}`;
                    } else {
                        document.getElementById("resultOutput").innerHTML = `${mileageEquals()}`;
                    }
                }
            } else {
                document.getElementById("resultOutput").innerHTML = `${yearWarning()}`;
            }
        }

        yearInput.addEventListener("input", inputHandler)
        monthInput.addEventListener("input", inputHandler)
        mileageInput.addEventListener("input", inputHandler)

        function resetData() {
            document.getElementById("form-group").reset();
        }

        function changeBodyBg(color) {
            document.getElementById("resultColored").style.background = color;
        }

        function convertNumberWithCommas(number) {
            return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        function mileageDisplay(max, cur) {
            let fmax = convertNumberWithCommas(max);
            let fcur = convertNumberWithCommas(cur);
            return `Max mileage: ${fmax} | Vehicle mileage: ${fcur}`;
        }

        function maxMileageGTMileage(max, cur) {
            let diff = max - cur;
            let fdiff = convertNumberWithCommas(diff);
            changeBodyBg("green");
            return `This vehicle is ${fdiff}km under average.`;
        }

        function maxMileageLTMileage(max, cur) {
            let diff = cur - max;
            let fdiff = convertNumberWithCommas(diff);
            changeBodyBg("red");
            return `This vehicle is ${fdiff}km over average.`;
        }

        function mileageEquals() {
            changeBodyBg("yellow");
            return `This vehicle's average mileage and current mileage match.`;
        }

        function yearWarning() {
            changeBodyBg("red");
            return `Year value is beyond current year.`;
        }

        function monthWarning() {
            changeBodyBg("red");
            return `Issue with month value.`;
        }
    </script>
</body>

</html>